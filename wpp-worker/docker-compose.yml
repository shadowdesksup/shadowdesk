version: '3.8'

services:
  # Servidor da API do WhatsApp
  wpp-server:
    image: wppconnect-team/wppconnect-server:latest
    container_name: wpp-server
    ports:
      - "21465:21465"
    environment:
      - SECRET_KEY=minha_senha_secreta
      - PORT=21465
    volumes:
      - ./sessions:/usr/src/app/tokens
    restart: always

  # Worker que lÃª o Firebase e dispara mensagens
  shadow-worker:
    build: .
    container_name: shadow-worker
    depends_on:
      - wpp-server
    environment:
      - WPP_URL=http://wpp-server:21465
      - WPP_SESSION=shadowdesk_bot
      - WPP_SECRET_KEY=minha_senha_secreta
    volumes:
      - ./chave-firebase.json:/app/chave-firebase.json
      - ./sessions:/app/sessions
    restart: always

  # Worker que monitora o ServiceDesk
  sd-worker:
    build: ../sd-worker
    container_name: sd-worker
    environment:
      - TZ=America/Sao_Paulo
    volumes:
      - ../sd-worker/serviceAccountKey.json:/app/serviceAccountKey.json
      - ../sd-worker/.env:/app/.env
    restart: always
